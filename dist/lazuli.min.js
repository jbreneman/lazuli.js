!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";function t(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),i=1;i<arguments.length;i++){var o=arguments[i];if(void 0!==o&&null!==o)for(var r=Object.keys(Object(o)),a=0,c=r.length;a<c;a++){var u=r[a],s=Object.getOwnPropertyDescriptor(o,u);void 0!==s&&s.enumerable&&(n[u]=o[u])}}return n}function e(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}function n(){var t={selector:".lazuli",background:!0,img:!0,fancy:!1,load:null,finished:null,events:!1},e=void 0;[].concat(Array.prototype.slice.call(arguments)).forEach(function(n){"string"==typeof n&&(t.selector=e=n),r(n)&&(t=Object.assign({},t,n),!n.selector&&e&&(t.selector=e))}),this.options=t,this.init(t)}var i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){!function(e){function n(){}function i(t,e){return function(){t.apply(e,arguments)}}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function r(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?a:c)(e.promise,t._value);var i;try{i=n(t._value)}catch(t){return void c(e.promise,t)}a(e.promise,i)})}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void f(i(n,e),t)}t._state=1,t._value=e,u(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)r(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}var l=setTimeout;o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var i=new this.constructor(n);return r(this,new s(t,e,i)),i},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function i(r,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(t){i(r,t)},n)}e[r]=a,0==--o&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var o=e.length,r=0;r<e.length;r++)i(r,e[r])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var i=0,o=t.length;i<o;i++)t[i].then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){l(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},t.exports?t.exports=o:e.Promise||(e.Promise=o)}(i)}),r=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};({assign:t,polyfill:e}).polyfill();var a=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};window.Promise||(window.Promise=o),n.prototype={_loadImage:function(t){return new o(function(e,n){var i=document.createElement("img");i.addEventListener("load",function(){this.removeEventListener("load",this),e(this)}),i.addEventListener("error",function(){this.removeEventListener("error",this),n(this)});for(var o in Object.assign({},t.dataset))"src"!==o&&i.setAttribute(o,t.dataset[o]);i.setAttribute("src",t.dataset.src)})},_load:function(t){var e=this;return new o(function(n,i){e._loadImage(t).then(function(n){"function"==typeof e.options.load&&e.options.load({image:t}),t.classList.add("loaded");for(var i in Object.assign({},t.dataset))delete t.dataset[i];return n}).then(function(t){n(t)}).catch(function(t){i(t)})})},_createInside:function(t){var e="\n\t\t\tbackground-image: url("+t+");\n\t\t\tbackground-position: inherit;\n\t\t\tbackground-size: inherit;\n\t\t\tbackground-repeat: inherit;\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\topacity: 0;\n\t\t\ttransition:\n\t\t\topacity .24s ease;\n\t\t\tz-index: -1;\n\t\t",n=document.createElement("div");return n.classList.add("lazuli-inner"),n.setAttribute("style",e),n},_background:function(t,e){if(this.options.fancy){var n=window.getComputedStyle(t,null);"static"===n.position&&(t.style.position="relative"),"auto"===n.zIndex&&(t.style.zIndex="0");var i=this._createInside(e.currentSrc||e.src);t.appendChild(i),t.firstElementChild.offsetHeight,t.querySelector(".lazuli-inner").style.opacity="1",window.setTimeout(function(){t.style.backgroundImage="none"},240)}else t.style.backgroundImage="url("+(e.currentSrc||e.src)+")"},_fireEvent:function(t,e){var n=new CustomEvent(t,{detail:e});document.dispatchEvent(n)},init:function(t){var e=this,n=document.querySelectorAll(t.selector),i=[];[].concat(a(n)).forEach(function(n){var o=!0;"IMG"===n.tagName&&(o=t.img),"IMG"!==n.tagName&&(o=t.background),o&&i.push(e._load(n).then(function(i){"IMG"===n.tagName?n.src=i.currentSrc||i.src:e._background(n,i),t.events&&e._fireEvent("lazuli:load",{image:n})}).catch(function(i){t.events&&e._fireEvent("lazuli:failed",{image:n}),console.error("Failed to load image: ",i)}))}),o.all(i).then(function(i){"function"==typeof t.finished&&t.finished({images:[].concat(a(n))}),t.events&&e._fireEvent("lazuli:finished",{images:[].concat(a(n))})}).catch(function(i){t.events&&e._fireEvent("lazuli:finished",{images:[].concat(a(n))}),console.error("Some images failed to load",i)})}},window.Lazuli=n});
