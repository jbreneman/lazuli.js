!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";function t(t,e){return e={exports:{}},t(e,e.exports),e.exports}function e(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(void 0!==o&&null!==o)for(var i=Object.keys(Object(o)),u=0,c=i.length;u<c;u++){var a=i[u],l=Object.getOwnPropertyDescriptor(o,a);void 0!==l&&l.enumerable&&(n[a]=o[a])}}return n}function n(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:e})}function r(){var t={selector:".lazuli",background:!0,img:!0,fancy:!1,load:null,finished:null,events:!1},e=void 0;[].concat(Array.prototype.slice.call(arguments)).forEach(function(n){"string"==typeof n&&(t.selector=e=n),u(n)&&(t=Object.assign({},t,n),!n.selector&&e&&(t.selector=e))}),this.options=t,this.init(t)}var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=t(function(t){!function(e){function n(){}function r(t,e){return function(){t.apply(e,arguments)}}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function i(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?u:c)(e.promise,t._value);var r;try{r=n(t._value)}catch(t){return void c(e.promise,t)}u(e.promise,r)})}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void a(t);if("function"==typeof n)return void f(r(n,e),t)}t._state=1,t._value=e,a(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,a(t)}function a(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)i(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}var s=setTimeout;o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new l(t,e,r)),r},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,function(t){r(i,t)},n)}e[i]=u,0==--o&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){s(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},t.exports?t.exports=o:e.Promise||(e.Promise=o)}(o)}),u=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};({assign:e,polyfill:n}).polyfill();var c=Object.prototype.toString,a=function(t){var e=c.call(t),n="[object Arguments]"===e;return n||(n="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===c.call(t.callee)),n},l=Object.prototype.hasOwnProperty,f=Object.prototype.toString,s=Array.prototype.slice,p=Object.prototype.propertyIsEnumerable,y=!p.call({toString:null},"toString"),b=p.call(function(){},"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(t){var e=t.constructor;return e&&e.prototype===t},m={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},v=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!m["$"+t]&&l.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{d(window[t])}catch(t){return!0}}catch(t){return!0}return!1}(),g=function(t){if("undefined"==typeof window||!v)return d(t);try{return d(t)}catch(t){return!1}},w=function(t){var e=null!==t&&"object"==typeof t,n="[object Function]"===f.call(t),r=a(t),o=e&&"[object String]"===f.call(t),i=[];if(!e&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var u=b&&n;if(o&&t.length>0&&!l.call(t,0))for(var c=0;c<t.length;++c)i.push(String(c));if(r&&t.length>0)for(var s=0;s<t.length;++s)i.push(String(s));else for(var p in t)u&&"prototype"===p||!l.call(t,p)||i.push(String(p));if(y)for(var d=g(t),m=0;m<h.length;++m)d&&"constructor"===h[m]||!l.call(t,h[m])||i.push(h[m]);return i};w.shim=function(){if(Object.keys){if(!function(){return 2===(Object.keys(arguments)||"").length}(1,2)){var t=Object.keys;Object.keys=function(e){return t(a(e)?s.call(e):e)}}}else Object.keys=w;return Object.keys||w};var j=w,S=Object.prototype.hasOwnProperty,O=Object.prototype.toString,T=function(t,e,n){if("[object Function]"!==O.call(e))throw new TypeError("iterator must be a function");var r=t.length;if(r===+r)for(var o=0;o<r;o++)e.call(n,t[o],o,t);else for(var i in t)S.call(t,i)&&e.call(n,t[i],i,t)},E="function"==typeof Symbol&&"symbol"==typeof Symbol(),I=Object.prototype.toString,_=function(t){return"function"==typeof t&&"[object Function]"===I.call(t)},A=Object.defineProperty&&function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(t){return!1}}(),P=function(t,e,n,r){(!(e in t)||_(r)&&r())&&(A?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n,writable:!0}):t[e]=n)},x=function(t,e){var n=arguments.length>2?arguments[2]:{},r=j(e);E&&(r=r.concat(Object.getOwnPropertySymbols(e))),T(r,function(r){P(t,r,e[r],n[r])})};x.supportsDescriptors=!!A;var N=x,C=Number.isNaN||function(t){return t!==t},F=Number.isNaN||function(t){return t!==t},$=Number.isFinite||function(t){return"number"==typeof t&&!F(t)&&t!==1/0&&t!==-1/0},k=Object.prototype.hasOwnProperty,R=Object.assign||function(t,e){for(var n in e)k.call(e,n)&&(t[n]=e[n]);return t},M=function(t){return t>=0?1:-1},z=function(t,e){var n=t%e;return Math.floor(n>=0?n:n+e)},D=function(t){return null===t||"function"!=typeof t&&"object"!=typeof t},L=function(t){return null===t||"function"!=typeof t&&"object"!=typeof t},G=Function.prototype.toString,U=/^\s*class /,K=function(t){try{var e=G.call(t),n=e.replace(/\/\/.*\n/g,""),r=n.replace(/\/\*[.\s\S]*\*\//g,""),o=r.replace(/\n/gm," ").replace(/ {2}/g," ");return U.test(o)}catch(t){return!1}},V=function(t){try{return!K(t)&&(G.call(t),!0)}catch(t){return!1}},q=Object.prototype.toString,B="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,H=function(t){if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(B)return V(t);if(K(t))return!1;var e=q.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e},W=Date.prototype.getDay,X=function(t){try{return W.call(t),!0}catch(t){return!1}},Y=Object.prototype.toString,Z="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,J=function(t){return"object"==typeof t&&null!==t&&(Z?X(t):"[object Date]"===Y.call(t))},Q=t(function(t){var e=Object.prototype.toString;if("function"==typeof Symbol&&"symbol"==typeof Symbol()){var n=Symbol.prototype.toString,r=/^Symbol\(.*\)$/,o=function(t){return"symbol"==typeof t.valueOf()&&r.test(n.call(t))};t.exports=function(t){if("symbol"==typeof t)return!0;if("[object Symbol]"!==e.call(t))return!1;try{return o(t)}catch(t){return!1}}}else t.exports=function(t){return!1}}),tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,et=function(t,e){if(void 0===t||null===t)throw new TypeError("Cannot call method on "+t);if("string"!=typeof e||"number"!==e&&"string"!==e)throw new TypeError('hint must be "string" or "number"');var n,r,o,i="string"===e?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<i.length;++o)if(n=t[i[o]],H(n)&&(r=n.call(t),L(r)))return r;throw new TypeError("No default value")},nt=function(t,e){var n=t[e];if(null!==n&&void 0!==n){if(!H(n))throw new TypeError(n+" returned for property "+e+" of object "+t+" is not a function");return n}},rt=function(t,e){if(L(t))return t;var n="default";arguments.length>1&&(e===String?n="string":e===Number&&(n="number"));var r;if(tt&&(Symbol.toPrimitive?r=nt(t,Symbol.toPrimitive):Q(t)&&(r=Symbol.prototype.valueOf)),void 0!==r){var o=r.call(t,n);if(L(o))return o;throw new TypeError("unable to convert exotic object to primitive")}return"default"===n&&(J(t)||Q(t))&&(n="string"),et(t,"default"===n?"number":n)},ot=Array.prototype.slice,it=Object.prototype.toString,ut=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==it.call(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var n,r=ot.call(arguments,1),o=function(){if(this instanceof n){var o=e.apply(this,r.concat(ot.call(arguments)));return Object(o)===o?o:this}return e.apply(t,r.concat(ot.call(arguments)))},i=Math.max(0,e.length-r.length),u=[],c=0;c<i;c++)u.push("$"+c);if(n=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var a=function(){};a.prototype=e.prototype,n.prototype=new a,a.prototype=null}return n},ct=Function.prototype.bind||ut,at=Object.prototype.toString,lt={"[[DefaultValue]]":function(t,e){var n=e||("[object Date]"===at.call(t)?String:Number);if(n===String||n===Number){var r,o,i=n===String?["toString","valueOf"]:["valueOf","toString"];for(o=0;o<i.length;++o)if(H(t[i[o]])&&(r=t[i[o]](),L(r)))return r;throw new TypeError("No default value")}throw new TypeError("invalid [[DefaultValue]] hint supplied")}},ft=function(t,e){return L(t)?t:lt["[[DefaultValue]]"](t,e)},st={ToPrimitive:ft,ToBoolean:function(t){return Boolean(t)},ToNumber:function(t){return Number(t)},ToInteger:function(t){var e=this.ToNumber(t);return C(e)?0:0!==e&&$(e)?M(e)*Math.floor(Math.abs(e)):e},ToInt32:function(t){return this.ToNumber(t)>>0},ToUint32:function(t){return this.ToNumber(t)>>>0},ToUint16:function(t){var e=this.ToNumber(t);if(C(e)||0===e||!$(e))return 0;var n=M(e)*Math.floor(Math.abs(e));return z(n,65536)},ToString:function(t){return String(t)},ToObject:function(t){return this.CheckObjectCoercible(t),Object(t)},CheckObjectCoercible:function(t,e){if(null==t)throw new TypeError(e||"Cannot call method on "+t);return t},IsCallable:H,SameValue:function(t,e){return t===e?0!==t||1/t==1/e:C(t)&&C(e)},Type:function(t){return null===t?"Null":void 0===t?"Undefined":"function"==typeof t||"object"==typeof t?"Object":"number"==typeof t?"Number":"boolean"==typeof t?"Boolean":"string"==typeof t?"String":void 0}},pt=st,yt=ct.call(Function.call,Object.prototype.hasOwnProperty),bt=RegExp.prototype.exec,ht=Object.getOwnPropertyDescriptor,dt=function(t){try{var e=t.lastIndex;return t.lastIndex=0,bt.call(t),!0}catch(t){return!1}finally{t.lastIndex=e}},mt=Object.prototype.toString,vt="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,gt=function(t){if(!t||"object"!=typeof t)return!1;if(!vt)return"[object RegExp]"===mt.call(t);var e=ht(t,"lastIndex");return!(!e||!yt(e,"value"))&&dt(t)},wt=Object.prototype.toString,jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator,St=jt?Symbol.prototype.toString:wt,Ot=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Tt=parseInt,Et=ct.call(Function.call,String.prototype.slice),It=ct.call(Function.call,RegExp.prototype.test,/^0b[01]+$/i),_t=ct.call(Function.call,RegExp.prototype.test,/^0o[0-7]+$/i),At=["","​","￾"].join(""),Pt=new RegExp("["+At+"]","g"),xt=ct.call(Function.call,RegExp.prototype.test,Pt),Nt=ct.call(Function.call,RegExp.prototype.test,/^[-+]0x[0-9a-f]+$/i),Ct=["\t\n\v\f\r   ᠎    ","         　\u2028","\u2029\ufeff"].join(""),Ft=new RegExp("(^["+Ct+"]+)|(["+Ct+"]+$)","g"),$t=ct.call(Function.call,String.prototype.replace),kt=function(t){return $t(t,Ft,"")},Rt=R(R({},pt),{Call:function(t,e){var n=arguments.length>2?arguments[2]:[];if(!this.IsCallable(t))throw new TypeError(t+" is not a function");return t.apply(e,n)},ToPrimitive:rt,ToNumber:function(t){var e=D(t)?t:rt(t,"number");if("symbol"==typeof e)throw new TypeError("Cannot convert a Symbol value to a number");if("string"==typeof e){if(It(e))return this.ToNumber(Tt(Et(e,2),2));if(_t(e))return this.ToNumber(Tt(Et(e,2),8));if(xt(e)||Nt(e))return NaN;var n=kt(e);if(n!==e)return this.ToNumber(n)}return Number(e)},ToInt16:function(t){var e=this.ToUint16(t);return e>=32768?e-65536:e},ToInt8:function(t){var e=this.ToUint8(t);return e>=128?e-256:e},ToUint8:function(t){var e=this.ToNumber(t);if(C(e)||0===e||!$(e))return 0;var n=M(e)*Math.floor(Math.abs(e));return z(n,256)},ToUint8Clamp:function(t){var e=this.ToNumber(t);if(C(e)||e<=0)return 0;if(e>=255)return 255;var n=Math.floor(t);return n+.5<e?n+1:e<n+.5?n:n%2!=0?n+1:n},ToString:function(t){if("symbol"==typeof t)throw new TypeError("Cannot convert a Symbol value to a string");return String(t)},ToObject:function(t){return this.RequireObjectCoercible(t),Object(t)},ToPropertyKey:function(t){var e=this.ToPrimitive(t,String);return"symbol"==typeof e?St.call(e):this.ToString(e)},ToLength:function(t){var e=this.ToInteger(t);return e<=0?0:e>Ot?Ot:e},CanonicalNumericIndexString:function(t){if("[object String]"!==wt.call(t))throw new TypeError("must be a string");if("-0"===t)return-0;var e=this.ToNumber(t);return this.SameValue(this.ToString(e),t)?e:void 0},RequireObjectCoercible:pt.CheckObjectCoercible,IsArray:Array.isArray||function(t){return"[object Array]"===wt.call(t)},IsConstructor:function(t){return"function"==typeof t&&!!t.prototype},IsExtensible:function(t){return!Object.preventExtensions||!D(t)&&Object.isExtensible(t)},IsInteger:function(t){if("number"!=typeof t||C(t)||!$(t))return!1;var e=Math.abs(t);return Math.floor(e)===e},IsPropertyKey:function(t){return"string"==typeof t||"symbol"==typeof t},IsRegExp:function(t){if(!t||"object"!=typeof t)return!1;if(jt){var e=t[Symbol.match];if(void 0!==e)return pt.ToBoolean(e)}return gt(t)},SameValueZero:function(t,e){return t===e||C(t)&&C(e)},GetV:function(t,e){if(!this.IsPropertyKey(e))throw new TypeError("Assertion failed: IsPropertyKey(P) is not true");return this.ToObject(t)[e]},GetMethod:function(t,e){if(!this.IsPropertyKey(e))throw new TypeError("Assertion failed: IsPropertyKey(P) is not true");var n=this.GetV(t,e);if(null!=n){if(!this.IsCallable(n))throw new TypeError(e+"is not a function");return n}},Get:function(t,e){if("Object"!==this.Type(t))throw new TypeError("Assertion failed: Type(O) is not Object");if(!this.IsPropertyKey(e))throw new TypeError("Assertion failed: IsPropertyKey(P) is not true");return t[e]},Type:function(t){return"symbol"==typeof t?"Symbol":pt.Type(t)},SpeciesConstructor:function(t,e){if("Object"!==this.Type(t))throw new TypeError("Assertion failed: Type(O) is not Object");var n=t.constructor;if(void 0===n)return e;if("Object"!==this.Type(n))throw new TypeError("O.constructor is not an Object");var r=jt&&Symbol.species?n[Symbol.species]:void 0;if(null==r)return e;if(this.IsConstructor(r))return r;throw new TypeError("no constructor found")}});delete Rt.CheckObjectCoercible;var Mt=Rt,zt=N.supportsDescriptors,Dt=function(t){var e=zt?Object.defineProperty:function(t,e,n){t[e]=n.value},n=this;if(null===t||void 0===t)throw new TypeError("`Array.from` requires an array-like object, not `null` or `undefined`");var r,o,i=Mt.ToObject(t);if(void 0!==arguments[1]){if(r=arguments[1],!Mt.IsCallable(r))throw new TypeError("When provided, the second argument to `Array.from` must be a function");arguments.length>2&&(o=arguments[2])}for(var u,c,a=Mt.ToLength(i.length),l=Mt.IsCallable(n)?Mt.ToObject(new n(a)):new Array(a),f=0;f<a;)u=i[f],c=r?void 0===o?r(u,f):Mt.Call(r,o,[u,f]):u,e(l,f,{configurable:!0,enumerable:!0,value:c,writable:!0}),f+=1;return l.length=a,l},Lt=function(t){try{return t(),!0}catch(t){return!1}},Gt=function(){return Mt.IsCallable(Array.from)&&Lt(function(){Array.from({length:-1/0})})&&!Lt(function(){Array.from([],void 0)})?Array.from:Dt},Ut=function(){var t=Gt();return N(Array,{from:t},{from:function(){return Array.from!==t}}),t},Kt=function(t){return Dt.apply(this||Array,arguments)};N(Kt,{getPolyfill:Gt,implementation:Dt,shim:Ut});var Vt=Kt,qt=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};window.Promise||(window.Promise=i),Vt.shim(),r.prototype={_loadImage:function(t){return new i(function(e,n){var r=document.createElement("img");r.addEventListener("load",function(){this.removeEventListener("load",this),e(this)}),r.addEventListener("error",function(){this.removeEventListener("error",this),n(this)});for(var o in Object.assign({},t.dataset))"src"!==o&&r.setAttribute(o,t.dataset[o]);r.setAttribute("src",t.dataset.src)})},_load:function(t){var e=this;return new i(function(n,r){e._loadImage(t).then(function(n){"function"==typeof e.options.load&&e.options.load({image:t}),t.classList.add("loaded");for(var r in Object.assign({},t.dataset))delete t.dataset[r];return n}).then(function(t){n(t)}).catch(function(t){r(t)})})},_createInside:function(t){var e="\n\t\t\tbackground-image: url("+t+");\n\t\t\tbackground-position: inherit;\n\t\t\tbackground-size: inherit;\n\t\t\tbackground-repeat: inherit;\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\topacity: 0;\n\t\t\ttransition:\n\t\t\topacity .24s ease;\n\t\t\tz-index: -1;\n\t\t",n=document.createElement("div");return n.classList.add("lazuli-inner"),n.setAttribute("style",e),n},_background:function(t,e){if(this.options.fancy){var n=window.getComputedStyle(t,null);"static"===n.position&&(t.style.position="relative"),"auto"===n.zIndex&&(t.style.zIndex="0");var r=this._createInside(e.currentSrc||e.src);t.appendChild(r),t.firstElementChild.offsetHeight,t.querySelector(".lazuli-inner").style.opacity="1",window.setTimeout(function(){t.style.backgroundImage="none"},240)}else t.style.backgroundImage="url("+(e.currentSrc||e.src)+")"},_fireEvent:function(t,e){var n=new CustomEvent(t,{detail:e});document.dispatchEvent(n)},init:function(t){var e=this,n=document.querySelectorAll(t.selector),r=[];[].concat(qt(n)).forEach(function(n){var o=!0;"IMG"===n.tagName&&(o=t.img),"IMG"!==n.tagName&&(o=t.background),o&&r.push(e._load(n).then(function(r){"IMG"===n.tagName?n.src=r.currentSrc||r.src:e._background(n,r),t.events&&e._fireEvent("lazuli:load",{image:n})}).catch(function(r){t.events&&e._fireEvent("lazuli:failed",{image:n}),console.error("Failed to load image: ",r)}))}),i.all(r).then(function(r){"function"==typeof t.finished&&t.finished({images:[].concat(qt(n))}),t.events&&e._fireEvent("lazuli:finished",{images:[].concat(qt(n))})}).catch(function(r){t.events&&e._fireEvent("lazuli:finished",{images:[].concat(qt(n))}),console.error("Some images failed to load",r)})}},window.Lazuli=r});
