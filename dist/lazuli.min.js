!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";function t(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(void 0!==o&&null!==o)for(var i=Object.keys(Object(o)),a=0,c=i.length;a<c;a++){var u=i[a],f=Object.getOwnPropertyDescriptor(o,u);void 0!==f&&f.enumerable&&(n[u]=o[u])}}return n}function e(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}function n(){var t=this,e={selector:".lazuli",background:!0,img:!0,fancy:!1,load:null},n=void 0;return[].concat(Array.prototype.slice.call(arguments)).forEach(function(t){"string"==typeof t&&(e.selector=n=t),i(t)&&(e=Object.assign({},e,t),!t.selector&&n&&(e.selector=n))}),this.options=e,new o(function(n,r){t.init(e).then(function(t){n(t)}).catch(function(t){r(t)})})}var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){!function(e){function n(){}function r(t,e){return function(){t.apply(e,arguments)}}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function i(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?a:c)(e.promise,t._value);var r;try{r=n(t._value)}catch(t){return void c(e.promise,t)}a(e.promise,r)})}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void l(r(n,e),t)}t._state=1,t._value=e,u(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)i(t,t._deferreds[e]);t._deferreds=null}function f(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}var s=setTimeout;o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new f(t,e,r)),r},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(t){r(i,t)},n)}e[i]=a,0==--o&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){s(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},t.exports?t.exports=o:e.Promise||(e.Promise=o)}(r)}),i=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};({assign:t,polyfill:e}).polyfill();var a=function(){var t=function(t){return"function"==typeof t},e=function(t){var e=Number(t);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e},n=Math.pow(2,53)-1,r=function(t){var r=e(t);return Math.min(Math.max(r,0),n)},o=function(t){if(null!=t){if(["string","number","boolean","symbol"].indexOf(typeof t)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in t)return Symbol.iterator;if("@@iterator"in t)return"@@iterator"}},i=function(e,n){if(null!=e&&null!=n){var r=e[n];if(null==r)return;if(!t(r))throw new TypeError(r+" is not a function");return r}},a=function(t){var e=t.next();return!Boolean(e.done)&&e};return function(e){var n,c=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!t(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}var f,l,s=i(e,o(e));if(void 0!==s){f=t(c)?Object(new c):[];var d=s.call(e);if(null==d)throw new TypeError("Array.from requires an array-like or iterable object");l=0;for(var h,y;;){if(!(h=a(d)))return f.length=l,f;y=h.value,f[l]=u?u.call(n,y,l):y,l++}}else{var p=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var m=r(p.length);f=t(c)?Object(new c(m)):new Array(m),l=0;for(var v;l<m;)v=p[l],f[l]=u?u.call(n,v,l):v,l++;f.length=m}return f}}(),c="function"==typeof Array.from?Array.from:a,u=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};window.Promise||(window.Promise=o),Array.from||(Array.from=c),n.prototype={_loadImage:function(t){return new o(function(e,n){var r=document.createElement("img");r.addEventListener("load",function(){this.removeEventListener("load",this),e(this)}),r.addEventListener("error",function(){this.removeEventListener("error",this),n(this)});for(var o in[].concat(u(t.dataset)))"src"!==o&&r.setAttribute(o,t.dataset[o]);r.setAttribute("src",t.dataset.src)})},_load:function(t){var e=this;return new o(function(n,r){e._loadImage(t).then(function(n){"function"==typeof e.options.load&&e.options.load({image:t}),t.classList.add("loaded");for(var r in Object.assign({},t.dataset))delete t.dataset[r];return n}).then(function(t){n(t)}).catch(function(t){r(t)})})},_createInside:function(t){var e="\n\t\t\tbackground-image: url("+t+");\n\t\t\tbackground-position: inherit;\n\t\t\tbackground-size: inherit;\n\t\t\tbackground-repeat: inherit;\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\topacity: 0;\n\t\t\ttransition: opacity .24s ease;\n\t\t\tz-index: -1;\n\t\t",n=document.createElement("div");return n.classList.add("lazuli-inner"),n.setAttribute("style",e),n},_background:function(t,e){if(this.options.fancy){var n=window.getComputedStyle(t,null);"static"===n.position&&(t.style.position="relative"),"auto"===n.zIndex&&(t.style.zIndex="0");var r=this._createInside(e.currentSrc||e.src);t.appendChild(r),t.firstElementChild.offsetHeight,t.querySelector(".lazuli-inner").style.opacity="1",t.style.filter="",window.setTimeout(function(){t.style.backgroundImage="none"},240)}else t.style.backgroundImage="url("+(e.currentSrc||e.src)+")"},init:function(t){var e=this,n=document.querySelectorAll(t.selector),r=[];return[].concat(u(n)).forEach(function(n){var o=!0;"IMG"===n.tagName&&(o=t.img),"IMG"!==n.tagName&&(o=t.background),o&&(e.options.fancy&&(n.style.filter="blur(3px)"),r.push(e._load(n).then(function(t){"IMG"===n.tagName?(n.src=t.currentSrc||t.src,n.style.filter=""):e._background(n,t)}).catch(function(t){console.error("Failed to load image: ",t)})))}),new o(function(t,e){o.all(r).then(function(e){t({images:[].concat(u(n))})}).catch(function(t){console.error("Some images failed to load",t),e({images:[].concat(u(n))})})})}},window.Lazuli=n});
