!function(){"use strict";function t(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert first argument to object");for(var n=Object(t),o=1;o<arguments.length;o++){var i=arguments[o];if(void 0!==i&&null!==i)for(var r=Object.keys(Object(i)),c=0,a=r.length;c<a;c++){var s=r[c],u=Object.getOwnPropertyDescriptor(i,s);void 0!==u&&u.enumerable&&(n[s]=i[s])}}return n}function e(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:t})}function n(){var t={selector:".lazuli",background:!0,img:!0,fancy:!0,load:null,finished:null};[].concat(Array.prototype.slice.call(arguments)).forEach(function(e){"string"==typeof e&&(t.className=e),r(e)&&(t=Object.assign({},t,e))}),this.options=t,this.init(t)}var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){!function(e){function n(){}function o(t,e){return function(){t.apply(e,arguments)}}function i(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function r(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,i._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?c:a)(e.promise,t._value);var o;try{o=n(t._value)}catch(t){return void a(e.promise,t)}c(e.promise,o)})}function c(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void s(t);if("function"==typeof n)return void f(o(n,e),t)}t._state=1,t._value=e,s(t)}catch(e){a(t,e)}}function a(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)r(t,t._deferreds[e]);t._deferreds=null}function u(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,c(e,t))},function(t){n||(n=!0,a(e,t))})}catch(t){if(n)return;n=!0,a(e,t)}}var l=setTimeout;i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var o=new this.constructor(n);return r(this,new u(t,e,o)),o},i.all=function(t){var e=Array.prototype.slice.call(t);return new i(function(t,n){function o(r,c){try{if(c&&("object"==typeof c||"function"==typeof c)){var a=c.then;if("function"==typeof a)return void a.call(c,function(t){o(r,t)},n)}e[r]=c,0==--i&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var i=e.length,r=0;r<e.length;r++)o(r,e[r])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(t){return new i(function(e,n){n(t)})},i.race=function(t){return new i(function(e,n){for(var o=0,i=t.length;o<i;o++)t[o].then(e,n)})},i._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){l(t,0)},i._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},i._setImmediateFn=function(t){i._immediateFn=t},i._setUnhandledRejectionFn=function(t){i._unhandledRejectionFn=t},t.exports?t.exports=i:e.Promise||(e.Promise=i)}(o)}),r=function(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)};({assign:t,polyfill:e}).polyfill();var c=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};window.Promise||(window.Promise=i),n.prototype={_loadImage:function(t){return new i(function(e,n){var o=document.createElement("img");o.addEventListener("load",function(){this.removeEventListener("load",this),e(this)}),o.addEventListener("error",function(){this.removeEventListener("error",this),n(this)});for(var i in Object.assign({},t.dataset))"src"!==i&&o.setAttribute(i,t.dataset[i]);o.setAttribute("src",t.dataset.src)})},_load:function(t){var e=this;return new i(function(n,o){e._loadImage(t).then(function(n){"function"==typeof e.options.load&&e.options.load({image:t}),t.classList.add("loaded");for(var o in Object.assign({},t.dataset))delete t.dataset[o];return n}).then(function(t){n(t)}).catch(function(t){o(t)})})},_createInside:function(t){var e="\n\t\t\tbackground-image: url("+t+");\n\t\t\tbackground-position: inherit;\n\t\t\tbackground-size: inherit;\n\t\t\tbackground-repeat: inherit;\n\t\t\tposition: absolute;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\topacity: 0;\n\t\t\ttransition:\n\t\t\topacity .24s ease;\n\t\t\tz-index: -1;\n\t\t",n=document.createElement("div");return n.classList.add("lazuli-inner"),n.setAttribute("style",e),n},_background:function(t,e){if(this.options.fancy){var n=window.getComputedStyle(t,null);"static"===n.position&&(t.style.position="relative"),"auto"===n.zIndex&&(t.style.zIndex="0");var o=this._createInside(e.currentSrc||e.src);t.appendChild(o),t.firstElementChild.offsetHeight,t.querySelector(".lazuli-inner").style.opacity="1",window.setTimeout(function(){t.style.backgroundImage="none"},240)}else t.style.backgroundImage="url("+(e.currentSrc||e.src)+")"},init:function(t){var e=this,n=document.querySelectorAll(t.selector),o=[];[].concat(c(n)).forEach(function(t){o.push(e._load(t).then(function(n){"IMG"===t.tagName&&e.options.img?t.src=n.currentSrc||n.src:e.options.background&&e._background(t,n)}).catch(function(t){console.error("Failed to load image: ",t)}))}),i.all(o).then(function(t){"function"==typeof e.options.finished&&e.options.finished({images:t})}).catch(function(t){console.error("Some images failed to load",t)})}},window.Lazuli=n}();
